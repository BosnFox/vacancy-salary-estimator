# Оглавление
- [Введение](#введение)
- [Цель проекта](#цель-проекта)
- [Используемый стек](#используемый-стек)
- [Данные](#данные)
- [Этапы проекта](#этапы-проекта)
  - [Сбор данных](#сбор-данных)
  - [Предобработка данных](#предобработка-данных)
  - [Обучение моделей](#обучение-моделей)
  - [Оценка моделей](#оценка-моделей)
- [Результаты](#результаты)
- [Структура проекта](#структура-проекта)
- [Возможные улучшени и будущая работа](#возможные-улучшения-и-будущая-работа)
- [Лицензия](#лицензия)
- [Контакты](#контакты)

## Введение
Данный проект посвящён разработке приложения для оценки стоимости вакансии на основе указанных данных, например, требуемого опыта, региона и других релевантных факторов. Подобные инструменты оценки стоимости вакансии суть "компас", позволяющий более уверенно ориентироваться на современном быстро развивающемся рынке труда.

## Цель проекта
Основная цель – построить и оценить модель регрессии, способную с удовлетворительною точностью предсказывать предлагаемую заработную плату. Данная основная цель определяет следующие дополнительные цели:
- Проведение разведочного анализа данных для выявления ключевых факторов, влияющих на зарплату.
- Подготовление данных для моделирования.
- Обучение и сравнение перформанса нескольких алгоритмов машинного обучения и выбор наилучшего.

## Используемый стек
- **Язык:** Python 3.9+
- **Библиотеки для получения данных:** `requests`, `time`, `datetime`
- **Библиотеки для анализа данных:** `pandas`, `numpy`, `json`
- **Библиотеки для машинного обучения:** `scikit-learn`, `xgboost`
- **Среда разработки:** `Google Colab`

## Данные
Обработанный и подготовленный для обучения датасет содержит информацию о 12293 вакансиях и включает следующие основные признаки:
- `accept_handicapped`: Подходит ли вакансия для людей с ограниченным возможностями (категориальный)
- `accept_kids`: Подходит ли вакансия для несовершеннолетних (категориальный)
- `accept_temporary`: Возможна ли временная занятость (категориальный)
- `area`: Регион (категориальный)
- `employment_form`: Тип занятости (категориальный)
- `experience`: Требуемый опыт (категориальный)
- `internship`: Является ли стажировкой (категориальный)
- `key_skills`: Требуемые особые навыки (список категориальных)
- `night_shifts`: Возможны ли ночные смены (категориальный)
- `work_format`: Формат работы (категориальный)
- `work_schedule_by_days`: График работы (категориальный)
- `working_hours`: Количество рабочих часов в неделю (категориальный)
- `driver_license`: Требуется ли наличие водительских прав (категориальный)
- `RUB_salary`: Заработная плата (числовой, целевая переменная)

**Примечание:** В связи с размером, сами файлы данных не включены в репозиторий. Их можно скачать [https://drive.google.com/file/d/1KGGHvTFoxLNYD5WUomzVfMgv_QM_mg11/view?usp=sharing] и поместить в папку `data/raw/`.

## Этапы проекта

## Сбор данных
Данные для проекта были получены с сайта hh.ru с помощью парсинга. Сбор данных проводился в феврале-марте 2025 года. При сборе данных использовались библиотеки `requests`, `time`, `datetime`.
Сайт hh.ru разделяет вакансии по индустриям и соответсвующим им подкатегориям. В рамках данной работы было принято решение о сборе данных в двух индустриях, IT и Media. 
Данный выбор определялся гипотезой о том, что в данных сферах оценка специалиста в значительной степени определяется сложной комбинацией его навыков и компетенций, что делает их интересным объектом для анализа взаимосвязи "навыки-зарплата".
После сбора были проведены предобработка данных и инжиниринг признаков с целью создания лучшей структуры данных и подготовки оных для последующего моделирования. 
Собранные данные хранились в формате CSV.
**Процесс сбора и предобработки данных:**
- Определены критерии поиска вакансий, с фокусом на IT и медиа индустрии. Скрипт последовательно обращался к страницам с результатами поиска, извлекая ссылки на индивидуальные страницы вакансий. Скрипт последовательно обращался к страницам с результатами поиска, извлекая ссылки на индивидуальные страницы вакансий.
- Для каждой потенциальной вакансии выполнялась проверка с помощью функции-верификатора, и далее только прошедшие верификацию вакансии использовались для извлечения детальной информации. Данная функция првоеряла, что информация о вакансии соответствовала следующим критериям:
  - Вакансия была одобрена модерацией сайта hh.ru
  - Город, указанный в вакансии, находился в топ-20 городов РФ
  - Указана информация по всем описанным выше важным полям (стоит отметить, что для целевой переменной для обучения выбиралась "зарплата от" или, в случае отсутствия значения для оной, "зарплата до", и в случае отсутствия какой-либо информации о заработной плате вакансия не проходила верификацию)
  - Валюта заработной платы указывается либо в российских рублях, либо в американских долларах, либо в евро
  - Вакансия была опубликована не позднее, чем 80 дней относительно даты проведения сбора данных
- В сыром виде, данные изобиловали лишними в рамках данного проекта параметрами, которые были удалены. Полный список параметров вакансии можно посмотреть по данной ссылке: [https://api.hh.ru/openapi/redoc#tag/Vakansii/operation/get-vacancy]. Для каждой вакансии парсились следующие поля: `accept_handicapped`, `accept_kids`, `accept_temporary`, `area`, `employment_form`, `experience`, `internship`, `key_skills`, `languages`, `night_shifts`, `salary, work_format`, `work_schedule_by_days`, `working_hours`, `levels`, `driver_license`, `currency`.

В результате, были собраны необходимые в рамках данного проекта данные о вакансиях. Ознакомиться с тем, как выглядели собранные данные, можно по данной ссылке [https://drive.google.com/file/d/1wD5vItLIv-TvJM2mcuVOdnfcPZws9Z5y/view?usp=sharing].

## Предобработка данных
На основе полученных данных была проведена тщательная предобработка данных и генерация новых признаков для подготовки датасета к обучению моделей.
Основные шаги предобработки данных включали:
- Обработку целевой переменной: значение параметра передавалось в качестве значения целевой переменной или, если заработная плата указывалась не в российских рублях, умножалась на курс валют по состоянию на февраль-март 2025 года и затем передавалась в качестве значения целевой переменной, при этом в итоге параметр currency полностью удалялся.
- Параметры `internship`, `night_shifts`, `employment_form`, `experience`, `work_format`, `work_schedule_by_days`, `working_hours` и `driver_license` суть категориальные, и для них сайтом dev.hh.ru представлены готовые порядковые иерархии, на основании которых был проведён encoding данных. Стоит разве что отметить, что для параметра `driver_license` значение (1 или 0) зависело от того, требуется ли в вакансии категория прав, соответствующая обыкновенным автомобилям.
- Параметр `languages` содержал список списков длины 2, в которых указывались язык и требуемый уровень владения оным. Информация из этого параметра добавлялись к информации параметра `key_skills` в виде "язык-уровень_владения". 
- Навыки, указанные в поле `key_skills`, представляли собой списки текстовых тегов. Для представления этих мульти-меток в числовом формате, пригодном для моделей машинного обучения, использовался `MultiLabelBinarizer` из библиотеки `scikit-learn`. Этот подход создает бинарный вектор для каждой вакансии, где каждый элемент вектора соответствует уникальному навыку из всего набора данных, и его значение (0 или 1) указывает на наличие или отсутствие данного навыка в конкретной вакансии.

Все шаги предобработки и инжиниринга признаков были реализованы таким образом, чтобы их можно было легко применить как к обучающей, так и к тестовой выборке, избегая утечки данных. В результате, собранные данные были подготовлены для обучения моделей машинного обучения. Ознакомиться с тем, как выглядели собранные данные, можно по данной ссылке [https://drive.google.com/file/d/1brITbz6oqY4PCrKlr5pZ0cj5LsBZ8o8q/view?usp=sharing].

## Обучение моделей
После подготовки данных были выбраны и обучены несколько моделей машинного обучения для решения задачи регрессии по прогнозирования заработной платы вакансии. Необходимо было найти модель, которая дает наилучшее качество предсказания на отложенной выборке.
Основные этапы обучения заключались в следующем:
- Собранные данные были разделен на обучающую и тестовую выборки в соотношении 85/15. Для предотвращения утечки данных, тестовая выборка откладывалась и не использовалась ни на одном из этапов отбора признаков или подбора гиперпараметров.
- Для сравнения были рассмотрены следующие алгоритмы:
  - Линейная регрессия
  - Линейная регрессия с L1 регуляризацией
  - Случайный лес
  - Градиентный бустинг
  - Адаптивны бустинг
  - XGBoosting
  - Полносвязанная нейронная сеть

## Оценка моделей
После обучения моделей на тренировочных данных их качество оценивалось на отложенной тестовой выборке, которая не участвовала в процессе обучения или подбора гиперпараметров. 
Метрики оценки качества перформанса моделей были средняя абсолютная ошибка на обучающей и тестирующей выборках и коэффицент детерминации R²-score.
Результат обучения
| Модель                  | MAE-train (руб.) | MAE-test (руб.) | R²-score |
|-------------------------|------------------|-----------------|----------|
| Linear Regression       | 19 000           | 28 000          | -0.0908  |
| Lasso Regression        | 21 500           | 28 000          | 0.4821   |
| RandomForest            | **13 000**       | **18 000**      | **0.7216**|
| GradientBoosting        | 29 000           | 28 000          | 0.4114   |
| AdaBoost                | 73 000           | 100 000         | -6.6305  |
| XGBoosting              | 20 000           | 23 000          | 0.6267   |
| MLPRegressor            | 26 000           | 27 000          | 0.5388   |

## Результаты
В ходе проекта были обучены и оценены несколько моделей машинного обучения, и наилучшие результаты на тестовой выборке показала модель, обученная на основе алгоритма случайного леса.
Показатели наилучшей модели суть следующие:
- R²-score = 0.7216, что означает, что выбранная модель способна объяснить примерно 72.2% дисперсии в уровне заработной платы на основе использованных признаков. 
- MAE-test = 18 000 рублей, что означает, что в среднем предсказания обученной модели на новых данных отклоняются от фактической заработной платы на 18 000 рублей.

Для целевой переменной с крайне высоким разбросом значений и с учётом сложности определения и учёта всех факторов, влияющих на зарплату, результаты работы наилучшей из обученных моделей, стремившихся объяснить распределение заработных плат исключительно на основе предположения об определяющей силе требуемых ключевых навыков, представляются вполне приемлемыми для практического применения.

## Структура проекта

```text
Репозиторий проекта имеет следующую структуру: vacancy-salary-estimator/
├── .git/             # Системная папка Git
├── .gitignore        # Файл для игнорируемых Git'om файлов и папок
├── README.md         # Данный файл с описанием проекта
├── LICENSE           # Файл лицензии (MIT License)
├── requirements.txt  # Список зависимостей Python для воспроизведения окружения
└── src/              # Исходный код на Python
    ├── data_processing.py    # Функции для загрузки и предобработки данных
    ├── feature_engineering.py # Функции для генерации признаков
    └── model_training.py     # Функции для обучения, предсказания моделей

## Возможные улучшени и будущая работа
Несмотря на достигнутые результаты, данный проект по прогнозированию заработной платы обладает значительным потенциалом для дальнейшего развития и улучшения. С учётом достигнутого уровня точности это становится особенно ясно видно, что существуют и другие, менее эксплицитные факторы, влияющие на заработную плату. Вероятно, анализ текстовых описаний вакансий, внешней информации о репутации компании, специфики текущего рыночного спроса на определенные комбинации редких навыков или даже неявных требований, не отраженных в структурированных полях, мог бы помочь улучшить предсказательную силу модели.

## Лицензия
Данный проект распространяется под лицензией MIT. Подробности можно найти в файле [LICENSE](LICENSE).

## Контакты
Если у вас есть вопросы, предложения или вы хотите обсудить этот проект, вы можете связаться со мной:

Email: bogdanovplaton@gmail.com
